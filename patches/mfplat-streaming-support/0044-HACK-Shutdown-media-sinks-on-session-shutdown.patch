From dabbfa4c200fc70b497bed6a79840531e1ace2b0 Mon Sep 17 00:00:00 2001
From: Derek Lesho <dlesho@codeweavers.com>
Date: Wed, 14 Oct 2020 11:07:34 -0500
Subject: [PATCH] HACK: Shutdown media sinks on session shutdown.

TODO: We should be doing this through IMFActivate.
---
 dlls/mf/session.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/dlls/mf/session.c b/dlls/mf/session.c
index fa6ed13db0c..ae5a600109c 100644
--- a/dlls/mf/session.c
+++ b/dlls/mf/session.c
@@ -1845,6 +1845,7 @@ static HRESULT WINAPI mfsession_Close(IMFMediaSession *iface)
 static HRESULT WINAPI mfsession_Shutdown(IMFMediaSession *iface)
 {
     struct media_session *session = impl_from_IMFMediaSession(iface);
+    struct media_sink *sink;
     HRESULT hr = S_OK;
 
     TRACE("%p.\n", iface);
@@ -1856,6 +1857,10 @@ static HRESULT WINAPI mfsession_Shutdown(IMFMediaSession *iface)
         IMFMediaEventQueue_Shutdown(session->event_queue);
         if (session->quality_manager)
             IMFQualityManager_Shutdown(session->quality_manager);
+        LIST_FOR_EACH_ENTRY(sink, &session->presentation.sinks, struct media_sink, entry)
+        {
+            IMFMediaSink_Shutdown(sink->sink);
+        }
         MFShutdownObject((IUnknown *)session->clock);
         IMFPresentationClock_Release(session->clock);
         session->clock = NULL;
-- 
2.29.2

