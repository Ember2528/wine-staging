From 14789ec13086da6769cb92888edd75c1b5c11a9d Mon Sep 17 00:00:00 2001
From: Sebastian Lackner <sebastian@fds-team.de>
Date: Wed, 26 Jul 2017 23:44:32 +0200
Subject: [PATCH] ntdll: Add back SS segment prefixes in set_full_cpu_context.

---
 dlls/ntdll/unix/signal_i386.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/dlls/ntdll/unix/signal_i386.c b/dlls/ntdll/unix/signal_i386.c
index 73b16b645bb..399644a334e 100644
--- a/dlls/ntdll/unix/signal_i386.c
+++ b/dlls/ntdll/unix/signal_i386.c
@@ -1001,12 +1001,16 @@ __ASM_GLOBAL_FUNC( set_full_cpu_context,
                    "movl 0x08(%ecx),%eax\n\t" /* Esp */
                    "leal -4*4(%eax),%eax\n\t"
                    "movl (%ecx),%edx\n\t"     /* EFlags */
+                   ".byte 0x36\n\t"
                    "movl %edx,3*4(%eax)\n\t"
                    "movl 0x0c(%ecx),%edx\n\t" /* SegCs */
+                   ".byte 0x36\n\t"
                    "movl %edx,2*4(%eax)\n\t"
                    "movl 0x04(%ecx),%edx\n\t" /* Eip */
+                   ".byte 0x36\n\t"
                    "movl %edx,1*4(%eax)\n\t"
                    "movl 0x18(%ecx),%edx\n\t" /* Eax */
+                   ".byte 0x36\n\t"
                    "movl %edx,0*4(%eax)\n\t"
                    "pushl 0x10(%ecx)\n\t"     /* SegDs */
                    "movl 0x24(%ecx),%edx\n\t" /* Edx */
-- 
2.20.1

