From 0a8a91199763c531cebeed0f60581df2e5ed36cf Mon Sep 17 00:00:00 2001
From: Sebastian Lackner <sebastian@fds-team.de>
Date: Thu, 2 Oct 2014 19:44:31 +0200
Subject: [PATCH] kernel32: Add winediag message to show warning, that this
 isn't vanilla wine.

---
 dlls/kernel32/process.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/dlls/kernel32/process.c b/dlls/kernel32/process.c
index 9d725e1a43b..9c678039dad 100644
--- a/dlls/kernel32/process.c
+++ b/dlls/kernel32/process.c
@@ -60,6 +60,7 @@
 
 WINE_DEFAULT_DEBUG_CHANNEL(process);
 WINE_DECLARE_DEBUG_CHANNEL(relay);
+WINE_DECLARE_DEBUG_CHANNEL(winediag);
 
 typedef struct
 {
@@ -125,6 +126,7 @@ static inline DWORD call_process_entry( PEB *peb, LPTHREAD_START_ROUTINE entry )
 }
 #endif
 
+extern const char * CDECL wine_get_version(void);
 /***********************************************************************
  *           __wine_start_process
  *
@@ -146,6 +148,14 @@ void CDECL __wine_start_process( LPTHREAD_START_ROUTINE entry, PEB *peb )
     TRACE_(relay)( "\1Starting process %s (entryproc=%p)\n",
                    debugstr_w(peb->ProcessParameters->ImagePathName.Buffer), entry );
 
+    if (CreateEventA(0, 0, 0, "__winestaging_warn_event") && GetLastError() != ERROR_ALREADY_EXISTS)
+    {
+        FIXME_(winediag)("Wine Staging %s is a testing version containing experimental patches.\n", wine_get_version());
+        FIXME_(winediag)("Please mention your exact version when filing bug reports on winehq.org.\n");
+    }
+    else
+        WARN_(winediag)("Wine Staging %s is a testing version containing experimental patches.\n", wine_get_version());
+
     __TRY
     {
         ExitThread( call_process_entry( peb, entry ));
-- 
2.28.0

